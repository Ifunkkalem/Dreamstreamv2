<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DreamStream PRO+ — Somnia Testnet</title>

  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>

<body>

<header class="topbar">
  <div class="brand">
    <img src="Ds.png" class="logo"/>
    <div>
      <h1>DreamStream PRO+</h1>
      <p class="muted">Powered by Somnia Testnet (STT)</p>
    </div>
  </div>

  <div class="controls">
    <input id="wallet-input" placeholder="0xYourAddress..."/>
    <button id="btn-connect" class="btn">Track Wallet</button>
    <button id="btn-metamask" class="btn outline">Connect MetaMask</button>
    <div id="live-indicator" class="indicator offline">OFFLINE</div>
  </div>
</header>

<main class="container">

  <section class="left">
    <div class="card game-frame">
      <h3>Pac-Man Mini Game — Somnia Hybrid</h3>
      <iframe id="pacman-iframe" src="pacman_hybrid.html" frameborder="0"></iframe>
    </div>
  </section>

</main>

<script>
let walletAddress = "";

// Connect wallet tunggal
async function connectWallet() {
    if (!window.ethereum) {
        alert("Please install MetaMask!");
        return;
    }
    try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        walletAddress = accounts[0];
        document.getElementById('wallet-input').value = walletAddress;
        document.getElementById('live-indicator').classList.remove('offline');
        document.getElementById('live-indicator').classList.add('online');
        document.getElementById('btn-connect').disabled = true;

        // Kirim alamat ke iframe Pac-Man
        const iframe = document.getElementById('pacman-iframe');
        iframe.contentWindow.postMessage({ type: 'walletConnected', address: walletAddress }, "*");

    } catch (err) {
        console.error(err);
    }
}

document.getElementById('btn-connect').addEventListener('click', connectWallet);
document.getElementById('btn-metamask').addEventListener('click', connectWallet);
</script>

</body>
</html>
