<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Pacman Hybrid — Somnia Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" href="pacman.css" />
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="config.js"></script>
<script src="web3.js"></script>
<script src="pacman_hybrid.js"></script>
</head>

<body style="background:#05060b; padding:10px;">

<h2 style="color:#59ffc9; font-family:Arial; margin-bottom:10px;">
    DreamStream — Pac-Man Hybrid
</h2>

<div>Wallet: <span id="addr" style="color:white;">Not Connected</span></div>

<div id="grid-container"></div>
<div>Score: <span id="score">0</span></div>

<button id="start-button"
    style="margin-top:10px; padding:8px 14px; background:#59ffc9; border:none; color:#000;">
    Start Game
</button>

<div id="mobile-controls">
    <button class="control-btn" data-dir="up">▲</button>
    <button class="control-btn" data-dir="left">◄</button>
    <button class="control-btn" data-dir="down">▼</button>
    <button class="control-btn" data-dir="right">►</button>
</div>

<script>
// Terima alamat wallet dari parent (index.html)
let walletAddress = null;
window.addEventListener('message', (event) => {
    if (event.data.type === 'walletConnected') {
        walletAddress = event.data.address;
        document.getElementById("addr").innerText = walletAddress;
    }
});

// Start Game pakai wallet dari index.html
document.getElementById("start-button").onclick = async () => {
    if (!walletAddress) return alert("Please connect wallet first!");
    const tx = await window.Web3Somnia.start(walletAddress);
    if (!tx) return alert("Start game failed!");
    alert("Game started on-chain!");
};

// Tombol arah mobile
document.querySelectorAll('.control-btn').forEach(btn => {
    btn.addEventListener('touchstart', () => movePacMan(btn.dataset.dir));
    btn.addEventListener('mousedown', () => movePacMan(btn.dataset.dir));
});

// Fungsi gerak karakter
function movePacMan(direction) {
    console.log("Move Pac-Man:", direction);
}
</script>

</body>
</html>
